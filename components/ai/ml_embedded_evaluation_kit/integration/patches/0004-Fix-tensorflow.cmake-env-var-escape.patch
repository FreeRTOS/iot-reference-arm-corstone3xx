From 2d22af627e51f62e95968cc75f51ff1238cf86ec Mon Sep 17 00:00:00 2001
From: Gabor Abonyi <gabor.abonyi@arm.com>
Date: Thu, 11 Jan 2024 14:16:57 +0100
Subject: [PATCH 4/4] Fix tensorflow.cmake env var escape

Signed-off-by: Gabor Abonyi <gabor.abonyi@arm.com>
---
 scripts/cmake/tensorflow.cmake | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/scripts/cmake/tensorflow.cmake b/scripts/cmake/tensorflow.cmake
index 8d52765..a028055 100644
--- a/scripts/cmake/tensorflow.cmake
+++ b/scripts/cmake/tensorflow.cmake
@@ -78,9 +78,9 @@ endif()
 
 if (TENSORFLOW_LITE_MICRO_CLEAN_DOWNLOADS)
     message(STATUS "Refreshing TensorFlow Lite Micro's third party downloads...")
+    set(ENV{PATH} "${ENV_PATH}")
     execute_process(
-        COMMAND ${CMAKE_COMMAND} -E env PATH=${ENV_PATH}
-        make -f ${TENSORFLOW_LITE_MICRO_PATH}/tools/make/Makefile clean_downloads third_party_downloads
+        COMMAND make -f ${TENSORFLOW_LITE_MICRO_PATH}/tools/make/Makefile clean_downloads third_party_downloads
         RESULT_VARIABLE return_code
         WORKING_DIRECTORY ${TENSORFLOW_SRC_PATH})
     if (NOT return_code EQUAL "0")
@@ -102,7 +102,7 @@ message(STATUS "TensorFlow Lite Micro build to be called for these targets: ${MA
 add_custom_target(tensorflow_build ALL
 
     # Command to build the TensorFlow Lite Micro library
-    COMMAND ${CMAKE_COMMAND} -E env PATH=${ENV_PATH}
+    COMMAND ${CMAKE_COMMAND} -E env PATH="${ENV_PATH}"
         make -j${PARALLEL_JOBS} -f ${TENSORFLOW_LITE_MICRO_PATH}/tools/make/Makefile ${MAKE_TARGETS_LIST}
         TARGET_TOOLCHAIN_ROOT=${TENSORFLOW_LITE_MICRO_TARGET_TOOLCHAIN_ROOT}
         TOOLCHAIN=${TENSORFLOW_LITE_MICRO_TOOLCHAIN}
-- 
2.40.1

